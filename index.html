<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customer Feedback Form</title>

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: #f4f6f5;
  color: #333;
  padding: 20px;
}

h2 {
  text-align: center;
  color: #2e7d32;
  margin-bottom: 20px;
}

form {
  max-width: 600px;
  margin: auto;
  background: #fff;
  padding: 25px 30px;
  border-radius: 12px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}

label {
  font-weight: 600;
  display: block;
  margin-top: 14px;
}

input[type=text], select, textarea {
  width: 100%;
  padding: 10px 12px;
  margin-top: 6px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
}

input:focus, select:focus, textarea:focus {
  border-color: #2e7d32;
  outline: none;
}

textarea { resize: vertical; }

.radio-group {
  display: flex;
  gap: 20px;
  margin-top: 6px;
}

.section {
  border-top: 1px solid #eee;
  padding-top: 18px;
  margin-top: 18px;
}

.section-title {
  font-size: 15px;
  font-weight: 700;
  color: #2e7d32;
  margin-bottom: 10px;
}

.char-counter {
  font-size: 12px;
  color: #666;
  text-align: right;
}

button {
  margin-top: 25px;
  width: 100%;
  padding: 12px;
  background: #2e7d32;
  color: #fff;
  font-size: 16px;
  font-weight: 600;
  border: none;
  border-radius: 8px;
  cursor: pointer;
}

button.loading {
  background: #9e9e9e;
  cursor: not-allowed;
}

.spinner {
  display: inline-block;
  width: 18px;
  height: 18px;
  border: 3px solid #fff;
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: 8px;
}

@keyframes spin { to { transform: rotate(360deg); } }

.toast {
  visibility: hidden;
  background: #4caf50;
  color: #fff;
  padding: 14px;
  border-radius: 8px;
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  font-weight: bold;
  opacity: 0;
  transition: all 0.4s ease;
}

.toast.show {
  visibility: visible;
  opacity: 1;
}

.section p {
  line-height: 1.5;
}

.credit {
  text-align: center;
  font-size: 12px;
  color: #777;
  margin-top: 14px;
}

@media (max-width: 500px) {
  form { padding: 20px; }
}
</style>
</head>

<body>

<h2>Customer Feedback Form</h2>

<div id="toastMessage" class="toast">
âœ… Thank you! Your feedback has been recorded.
</div>

<iframe name="hidden_iframe" style="display:none;" onload="submitted();"></iframe>

<form id="feedbackForm"
action="https://script.google.com/macros/s/AKfycbxc2AwN9lwB13VqrN6bZYE46dNB2ZTysB8pfbT4v3xFMeuZ8UQeZLiNTIXT5GvuK4o/exec"
method="post"
target="hidden_iframe">

<!-- CUSTOMER INFO -->
<div class="section">
  <div class="section-title">Customer Information</div>

  <label>Customer Name (Optional)</label>
  <input type="text" name="customerName">

  <label>Branch Name</label>
  <div style="display:flex; flex-direction:column; gap:6px;">
    <input type="text" id="branchName" name="branchName" required
    placeholder="Enter branch name exactly as on official branch signage">

    <button type="button"
      id="openBranchFinder"
      style="
        display:inline-block;
        font-size:13px;
        padding:6px 10px;
        background:#2e7d32;
        color:#fff;
        border-radius:6px;
        border:none;
        cursor:pointer;
        width:120px;
      ">
      ðŸ”Ž Branch Finder
    </button>
  </div>
</div>

<!-- Branch Finder Modal -->
<div id="branchFinderModal" style="
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.5);
  justify-content:center;
  align-items:center;
  z-index:1000;
">
  <div style="
    background:#fff;
    padding:20px;
    border-radius:12px;
    max-width:600px;
    width:90%;
    max-height:80%;
    overflow:auto;
    box-shadow:0 6px 20px rgba(0,0,0,0.2);
    position:relative;
  ">
    <button id="closeBranchFinder" style="
      position:absolute;
      top:10px;
      right:10px;
      background:#2e7d32;
      color:#fff;
      border:none;
      border-radius:6px;
      padding:4px 8px;
      cursor:pointer;
    ">âœ–</button>
    <h3 style="color:#2e7d32; margin-bottom:10px;">Branch Finder</h3>
    <input type="text" id="branchSearchInput" placeholder="Type keyword to search..." style="width:100%; padding:10px; border-radius:6px; border:1px solid #ccc; margin-bottom:10px;">
    <div id="branchSearchResults" style="max-height:400px; overflow-y:auto;"></div>
  </div>
</div>

<!-- TRANSACTION -->
<div class="section">
  <div class="section-title">Transaction Details</div>

  <label>Customer Type</label>
  <select name="customerType" required>
    <option value="">Select</option>
    <option>New</option>
    <option>Returning</option>
  </select>

  <label>Transaction Type</label>
  <select name="transactionType" required>
    <option value="">Select</option>
    <option>Pawning</option>
    <option>Pera Padala</option>
    <option>International Remittance</option>
    <option>Money Changer</option>
    <option>Bills Payment</option>
    <option>Other</option>
  </select>

  <label>Waiting Time</label>
  <select name="waitingTime" required>
    <option value="">Select</option>
    <option>Less than 5 minutes</option>
    <option>5â€“10 minutes</option>
    <option>10â€“20 minutes</option>
    <option>More than 20 minutes</option>
  </select>
</div>

<!-- SERVICE FEEDBACK -->
<div class="section">
  <div class="section-title">Service Feedback</div>

  <label>Overall Satisfaction (1â€“5)</label>
  <select name="satisfaction" required>
    <option value="">Select</option>
    <option>1 - Very Poor</option>
    <option>2 - Poor</option>
    <option>3 - Average</option>
    <option>4 - Good</option>
    <option>5 - Excellent</option>
  </select>

  <label>Would you recommend us?</label>
  <div class="radio-group">
    <label><input type="radio" name="recommend" value="Yes" required> Yes</label>
    <label><input type="radio" name="recommend" value="No"> No</label>
  </div>
</div>

<!-- COMMENTS -->
<div class="section">
  <div class="section-title">Comments</div>

  <label>What can we improve? (max 500 characters)</label>
  <textarea id="improve" name="improve" maxlength="500"></textarea>
  <div class="char-counter" id="improveCounter">0 / 500</div>

  <label>Additional Comments (max 500 characters)</label>
  <textarea id="additional" name="additional" maxlength="500"></textarea>
  <div class="char-counter" id="additionalCounter">0 / 500</div>
</div>

<label style="margin-top:14px;">
  <input type="checkbox" required>
  I agree that my feedback will be used for service improvement purposes.
</label>

<button type="submit" id="submitBtn">Submit Feedback</button>

<!-- CUSTOMER CARE CONTACT -->
<div class="section">
  <div class="section-title">Customer Care Assistance</div>

  <p>You may also reach us through our <strong>Customer Care hotlines</strong>:</p>

  <p>
    <strong>For Calls only:</strong><br>
    Globe: 0917-301-3868<br>
    Sun: 0932-850-8613<br>
    Smart: 0998-962-1869<br>
    Landline: (048) 433-4110
  </p>

  <p>
    <strong>For SMS only:</strong><br>
    Globe: 0917-838-6024<br>
    Smart: 0919-061-5654
  </p>

  <p>
    Please follow this format when sending SMS:<br>
    <em>(Name, Location, Concern)</em>
  </p>

  <p>
    You may also send us an email at:<br>
    <strong>customercare@palawanpawnshop.com</strong>
  </p>

  <p style="font-weight:600; color:#2e7d32;">
    Happy to serve you.
  </p>
</div>

<p class="credit">Form designed by CCR John Ramos</p>

<script>
const form = document.getElementById("feedbackForm");
const btn = document.getElementById("submitBtn");

form.addEventListener("submit", () => {
  btn.disabled = true;
  btn.classList.add("loading");
  btn.innerHTML = '<span class="spinner"></span> Sending...';
});

function submitted() {
  if (form.checkValidity()) {
    form.reset();
    btn.disabled = false;
    btn.classList.remove("loading");
    btn.innerHTML = "Submit Feedback";

    const toast = document.getElementById("toastMessage");
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 3000);
  }
}

// Character counters
const improve = document.getElementById("improve");
const improveCounter = document.getElementById("improveCounter");
improve.addEventListener("input", () => {
  improveCounter.textContent = `${improve.value.length} / 500`;
});

const additional = document.getElementById("additional");
const additionalCounter = document.getElementById("additionalCounter");
additional.addEventListener("input", () => {
  additionalCounter.textContent = `${additional.value.length} / 500`;
});

// ===== Branch Finder Script =====
const branchFinderBtn = document.getElementById("openBranchFinder");
const branchModal = document.getElementById("branchFinderModal");
const closeBranchBtn = document.getElementById("closeBranchFinder");
const branchSearchInput = document.getElementById("branchSearchInput");
const branchSearchResults = document.getElementById("branchSearchResults");
const branchNameField = document.getElementById("branchName");

let branchData = []; // Will hold branch names & addresses

// Load branch data
fetch("https://script.google.com/macros/s/AKfycbwCrTNlCRGE3MVHwaCl-uZIknEAlMaPBk3HO-7tfRAplME7bAJS3n9gojnli-kwfiOO/exec")
  .then(res => res.json())
  .then(data => branchData = data);

// Open modal
branchFinderBtn.addEventListener("click", () => {
  branchModal.style.display = "flex";
  branchSearchInput.value = "";
  branchSearchResults.innerHTML = "";
  branchSearchInput.focus();
});

// Close modal
closeBranchBtn.addEventListener("click", () => {
  branchModal.style.display = "none";
});

// Close modal when clicking outside content
branchModal.addEventListener("click", e => {
  if(e.target === branchModal) branchModal.style.display = "none";
});

// Auto-search while typing
branchSearchInput.addEventListener("input", () => {
  const keyword = branchSearchInput.value.toLowerCase().trim();
  branchSearchResults.innerHTML = "";
  if(!keyword) return;

  let found = 0;
  branchData.forEach(r => {
    if((r.b || "").toLowerCase().includes(keyword)){
      found++;
      const div = document.createElement("div");
      div.style.padding = "10px";
      div.style.borderBottom = "1px solid #eee";
      div.style.cursor = "pointer";
      div.innerHTML = `<strong>${r.a}</strong><br><small>${r.b}</small>`;
      div.addEventListener("click", () => {
        branchNameField.value = r.a;
        branchModal.style.display = "none";
      });
      branchSearchResults.appendChild(div);
    }
  });

  if(found === 0){
    branchSearchResults.innerHTML = "<p style='text-align:center; color:#888;'>No results found</p>";
  }
});
</script>

</body>
</html>
